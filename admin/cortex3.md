# Cortex 3

## New analyzers / responders communication
From version 3, cortexutils 2.x is required because communication between Cortex and the analyzers/responders has changed. **Analyzers and responders doesn't need to be rewritten if they use cortexutils**. Cortex 2 send data using stdin and receive result from stdout.

Cortex 3 uses files: a job is stored in a folder with the following structure:
```
job_folder
  \_ input
   |    \_ input.json    <- input data, equivalent to stdin with Cortex 2.x
   |    |_ attachment    <- optional extra file when analysis concerns a file
   |_ output
        \_ output.json   <- report of the analysis (generated by analyzer or responder)
        |_ extra_file(s) <- optional extra files linked to report (generated by analyzer)
```
Job folder is provided to analyzer/responder as argument. Currently, only one job is acceptable but in future release, analyzer/responder will accept several job at a time (bulk mode) in order to increase performance.

## Dockerized analyzers / responders
Cortex 3 comes with a new way to run analyzers and responders. It can execute them as a docker image, if docker service is available for Cortex service.

In Cortex configuration file, `analyzer.urls` and `responder.urls` (previously `analyzer.path` and `responder.path`) tell Cortex how to find analyzers and responders. These settings accept:
   - a path to a directory where workers are installed (like previous version of Cortex)
   - a path or an url (http(s)) to a JSON file containing all worker definitions (merge of all JSON in one array)

If you want to use dockerized analyzers, you can add the following urls:
 - [analyzers-stable.json](https://bintray.com/thehive-project/cortexneurons/download_file?file_path=analyzers-stable.json) (once used, analyzer is never updated) 
 - [analyzers.json](https://bintray.com/thehive-project/cortexneurons/download_file?file_path=analyzers.json) (updated when new version is released) 
 - [analyzers-devel.json](https://bintray.com/thehive-project/cortexneurons/download_file?file_path=analyzers-devel.json) (updated at each commit, used for development)

For responders urls are:
  - [responders-stable.json](https://bintray.com/thehive-project/cortexneurons/download_file?file_path=responders-stable.json) (once used, analyzer is never updated) 
  - [responders.json](https://bintray.com/thehive-project/cortexneurons/download_file?file_path=responders.json) (updated when new version is released) 
  - [responders-devel.json](https://bintray.com/thehive-project/cortexneurons/download_file?file_path=responders-devel.json) (updated at each commit, used for development)

  